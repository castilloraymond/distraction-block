# Fix CSP Violation Bug - Chrome Extension Refresh

**Date:** 2026-01-21
**Issue:** Content Security Policy violation when loading blocked.js in blocked.html

## Problem Analysis

The Chrome extension shows CSP errors when refreshing:
- Error: `Executing inline script violates CSP directive 'script-src 'self''`
- Context: `src/pages/blocked.html:58` trying to load `blocked.js`
- Root cause: `blocked.js` is not listed in `web_accessible_resources` in manifest.json

Currently, manifest.json only includes:
```json
"web_accessible_resources": [
  {
    "resources": ["src/pages/blocked.html"],
    "matches": ["<all_urls>"]
  }
]
```

But blocked.html loads blocked.js via `<script src="blocked.js"></script>` on line 57.

## Solution

Add `src/pages/blocked.js` to the `web_accessible_resources` array in manifest.json so the script can be loaded by blocked.html.

## Implementation Plan

- [x] Update manifest.json to include blocked.js in web_accessible_resources
- [ ] Test: Reload extension in Chrome (user action required)
- [ ] Test: Navigate to a blocked site (user action required)
- [ ] Verify: No CSP errors in console (user action required)
- [ ] Verify: blocked.js functionality works (timer display, schedule display, etc.)

## Files to Modify

1. `/Users/raymond/Projects/distraction-block/website-blocker/manifest.json` (line 31-36)
   - Add `"src/pages/blocked.js"` to resources array

## Review

### Changes Made

**File:** `website-blocker/manifest.json:31-36`

Modified the `web_accessible_resources` section to include `blocked.js`:

```json
"web_accessible_resources": [
  {
    "resources": [
      "src/pages/blocked.html",
      "src/pages/blocked.js"  // ‚Üê Added this line
    ],
    "matches": ["<all_urls>"]
  }
]
```

### Why This Fixes The Bug

The CSP error occurred because:
1. Chrome's Manifest V3 requires all resources loaded by web-accessible pages to be explicitly declared
2. `blocked.html` loads `blocked.js` via `<script src="blocked.js"></script>` (line 57)
3. Without declaring `blocked.js` in `web_accessible_resources`, Chrome blocks the script execution due to CSP

By adding `blocked.js` to the resources array, the script can now be loaded properly.

### Testing Instructions

1. Open Chrome and go to `chrome://extensions/`
2. Click the reload button for "Website Blocker" extension
3. Navigate to a blocked website
4. Open DevTools Console (F12)
5. Verify: No CSP errors appear
6. Verify: Timer/schedule functionality displays correctly on blocked page
