# Scheduled Distraction Block Feature

**Date**: 2026-01-20
**Task**: Add scheduled blocking capability to site lists (e.g., 6-11AM weekdays)

## Overview

Allow users to configure schedules on site lists so that sites are automatically blocked during specific time windows on specific days, without needing to manually start a timer.

## Implementation Plan

### Phase 1: Storage Schema Extension

- [ ] **1.1** Extend site list schema in storage to include schedule configuration:
  ```javascript
  schedule: {
    enabled: false,
    days: [],           // ["mon", "tue", "wed", "thu", "fri", "sat", "sun"]
    startTime: "06:00", // HH:MM format (24-hour)
    endTime: "11:00"
  }
  ```

### Phase 2: Schedule Evaluation Logic (background.js)

- [ ] **2.1** Add `isScheduleActive(schedule)` function to check if current time falls within a schedule
- [ ] **2.2** Add `getActiveScheduledLists()` function to return all site lists with currently active schedules
- [ ] **2.3** Modify `generateRules()` to include sites from active scheduled lists (separate from timer rules)
- [ ] **2.4** Add periodic alarm `scheduleCheck` that fires every minute to re-evaluate schedules
- [ ] **2.5** Handle schedule transitions (entering/exiting scheduled block periods) by regenerating rules

### Phase 3: Popup UI (popup.js + popup.html)

- [ ] **3.1** Add schedule configuration UI section to the site list modal/form
- [ ] **3.2** Add day-of-week checkboxes (Mon-Sun)
- [ ] **3.3** Add time picker inputs for start and end times
- [ ] **3.4** Add "Enable Schedule" toggle
- [ ] **3.5** Save schedule data when saving site list
- [ ] **3.6** Display schedule status indicator on site lists

### Phase 4: Integration & Edge Cases

- [ ] **4.1** Ensure scheduled blocks work independently of timer (coexist)
- [ ] **4.2** Handle rule ID ranges: use 100000-149999 for scheduled list rules
- [ ] **4.3** Update blocked.html to show schedule info when blocked by schedule
- [ ] **4.4** Initialize schedule checker alarm on extension startup

## Technical Details

### Rule Priority System
- Priority 2: Whitelist/allow rules (highest)
- Priority 1: Timer blocks, scheduled blocks, individual blocks

### Rule ID Ranges
- 1000-49999: Individual blocked sites
- 50000-99999: Timer-based blocking
- 100000-149999: Schedule-based blocking (NEW)

### Storage Location
- Schedule config stored within each site list object in `siteLists` array

## Files to Modify

1. **background.js** - Schedule logic, rule generation, alarm handling
2. **popup.js** - Schedule UI logic, save/load schedules
3. **popup.html** - Schedule form inputs in site list modal
4. **blocked.html** - Display schedule info when blocked by schedule

## Review

*(To be completed after implementation)*

